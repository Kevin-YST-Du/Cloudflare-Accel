# Cloudflare-Accel (Ultimate Edition)

åŸºäº Cloudflare Workers çš„å…¨èƒ½ä¸‹è½½ä»£ç†ä¸ Docker é•œåƒåŠ é€ŸæœåŠ¡ã€‚

è¿™æ˜¯ä¸€ä¸ªé›†æˆäº† **Docker é•œåƒæ™ºèƒ½åŠ é€Ÿ**ã€**é€šç”¨æ–‡ä»¶/ç½‘é¡µä»£ç†**ã€**å¤§æ–‡ä»¶æµå¼å¤„ç†** ä»¥åŠ **å®‰å…¨é˜²æŠ¤** äºä¸€ä½“çš„ç»ˆæè§£å†³æ–¹æ¡ˆã€‚å®ƒè§£å†³äº† Docker æ‹‰å– AWS S3/Cloudflare R2 èµ„æºæ—¶çš„ 403 ç­¾åé”™è¯¯ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå¹¶æä¾›äº†ç›´è§‚çš„ Web ç®¡ç†ç•Œé¢ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹ç‚¹

### 1. ğŸ³ Docker é•œåƒåŠ é€Ÿ (æ ¸å¿ƒå¢å¼º)
- **æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨è¯†åˆ« Docker å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆUser-Agent æ£€æµ‹ï¼‰ï¼Œ**CLI æ‹‰å–æ— éœ€å¯†ç **ã€‚
- **è·¯å¾„è¡¥å…¨**: è‡ªåŠ¨ä¸º Docker Hub å®˜æ–¹é•œåƒè¡¥å…¨ `library/` å‰ç¼€ï¼ˆå¦‚ `docker pull domain/nginx` è‡ªåŠ¨è½¬æ¢ä¸º `library/nginx`ï¼‰ã€‚
- **S3 ç­¾åä¿®å¤**: æ™ºèƒ½è¯†åˆ«å¹¶ä¿®å¤ Docker Layer åœ¨é‡å®šå‘åˆ° AWS S3/R2 æ—¶çš„ç­¾åé—®é¢˜ï¼Œå½»åº•è§£å†³ `403 Forbidden` é”™è¯¯ã€‚
- **é€’å½’å¤„ç†**: è‡ªåŠ¨è¿½è¸ªå¤šçº§ 302/307 è·³è½¬ï¼Œç¡®ä¿é•œåƒæ‹‰å–æˆåŠŸç‡ã€‚
- **å¤šä»“åº“æ”¯æŒ**: å®Œç¾æ”¯æŒ `docker.io`, `ghcr.io`, `quay.io`, `k8s.gcr.io` ç­‰ä¸»æµä»“åº“ã€‚

### 2. âš¡ é€šç”¨æ–‡ä»¶/ç½‘é¡µä»£ç†
- **å¯†ç ä¿æŠ¤**: æ™®é€šæ–‡ä»¶ä¸‹è½½æˆ–ç½‘é¡µè®¿é—®éœ€é€šè¿‡ `/å¯†ç /` è·¯å¾„éªŒè¯ï¼Œé˜²æ­¢æ¶æ„ç›—ç”¨ã€‚
- **æµå¼å¤„ç†**: æ”¯æŒæ— é™å¤§å°çš„å¤§æ–‡ä»¶æµå¼ä¼ è¾“ï¼Œå†…å­˜å ç”¨æä½ã€‚
- **å†…å®¹é‡å†™**:
    - è‡ªåŠ¨æ›¿æ¢ `.sh/.py` è„šæœ¬ä¸­çš„ URL ä¸ºä»£ç†é“¾æ¥ã€‚
    - è‡ªåŠ¨é‡å†™ç½‘é¡µ HTML ä¸­çš„ `href`/`src` é“¾æ¥ã€‚
- **é˜²ç›—é“¾ä¼ªè£…**: è‡ªåŠ¨ä¿®æ”¹ Referer/Origin/User-Agentï¼Œç»•è¿‡ç›®æ ‡ç½‘ç«™é™åˆ¶ã€‚

### 3. ğŸ›¡ï¸ å®‰å…¨ä¸éšç§
- **éšèº«æ¨¡å¼**: è®¿é—®æ ¹ç›®å½•æˆ–é”™è¯¯å¯†ç è¿”å› 404ï¼Œåªæœ‰çŸ¥é“å¯†ç æ‰èƒ½çœ‹åˆ°ç®¡ç†é¢æ¿ã€‚
- **è®¿é—®æ§åˆ¶**: æ”¯æŒ **IP ç™½åå•** å’Œ **å›½å®¶/åœ°åŒºé™åˆ¶**ã€‚
- **é»‘ç™½åå•**: å¯é…ç½®ç›®æ ‡åŸŸåçš„é»‘åå•æˆ–ç™½åå•ã€‚
- **éšç§ä¿æŠ¤**: å†…ç½® `robots.txt` ç¦æ­¢æœç´¢å¼•æ“çˆ¬è™«æ”¶å½•ã€‚

### 4. ğŸ¨ ç°ä»£åŒ– UI
- **ç»å…¸åŒæ è®¾è®¡**: ä¸Šæ–¹é€šç”¨åŠ é€Ÿï¼ˆå¸¦æ‰“å¼€é“¾æ¥ï¼‰ï¼Œä¸‹æ–¹ Docker åŠ é€Ÿï¼ˆå¸¦å¤åˆ¶å‘½ä»¤ï¼‰ã€‚
- **é…ç½®ç”Ÿæˆå™¨**: UI åº•éƒ¨ä¸€é”®ç”Ÿæˆ `daemon.json` é…ç½®å†…å®¹ã€‚
- **è‡ªåŠ¨é€‚é…**: æ”¯æŒæ·±è‰²/æµ…è‰²æ¨¡å¼åˆ‡æ¢ã€‚

---

## ğŸ› ï¸ éƒ¨ç½²æ–¹æ³•

### 1. éƒ¨ç½²ä»£ç 
1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)ã€‚
2. è¿›å…¥ **Workers & Pages** -> **Create Application** -> **Create Worker**ã€‚
3. å‘½åä½ çš„ Workerï¼ˆä¾‹å¦‚ `docker-accel`ï¼‰ï¼Œç‚¹å‡» **Deploy**ã€‚
4. ç‚¹å‡» **Edit code**ï¼Œå°†æœ¬é¡¹ç›®æä¾›çš„ `worker.js` ä»£ç å…¨é€‰ç²˜è´´è¦†ç›–ï¼Œ**Save and Deploy**ã€‚

### 2. é…ç½®ç¯å¢ƒå˜é‡ (æ¨è)
ä¸ºäº†å®‰å…¨å’Œçµæ´»æ€§ï¼Œå»ºè®®åœ¨ Cloudflare åå°è®¾ç½®é…ç½®ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ä»£ç ã€‚
è¿›å…¥ Worker çš„ **Settings** -> **Variables**ï¼Œæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
| :--- | :--- | :--- |
| `PASSWORD` | **[å¿…å¡«]** è®¿é—®å¯†ç  (ç”¨äº Web ç•Œé¢å’Œæ™®é€šä»£ç†) | `123456` |
| `ALLOW_IPS` | å…è®¸è®¿é—®çš„å®¢æˆ·ç«¯ IP (é€—å·åˆ†éš”ï¼Œç•™ç©ºä¸é™åˆ¶) | `1.2.3.4, 223.5.5.5` |
| `ALLOW_COUNTRIES` | å…è®¸è®¿é—®çš„å›½å®¶ä»£ç  (é€—å·åˆ†éš”ï¼Œç•™ç©ºä¸é™åˆ¶) | `CN, US, HK` |
| `BLACKLIST` | ç›®æ ‡åŸŸåé»‘åå• (ç¦æ­¢ä»£ç†è®¿é—®çš„åŸŸå) | `baidu.com, qq.com` |
| `WHITELIST` | ç›®æ ‡åŸŸåç™½åå• (åªå…è®¸ä»£ç†è®¿é—®çš„åŸŸå) | `github.com, raw.githubusercontent.com` |
| `ENABLE_CACHE` | æ˜¯å¦å¼€å¯ Cloudflare ç¼“å­˜ (`true`/`false`) | `true` |

*(æ³¨ï¼šå¦‚æœæœªè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»£ç å°†ä½¿ç”¨æ–‡ä»¶é¡¶éƒ¨çš„ `DEFAULT_CONFIG` é»˜è®¤å€¼)*

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

å‡è®¾ä½ çš„ Worker åŸŸåä¸º `docker.example.com`ï¼Œè®¾ç½®çš„å¯†ç ä¸º `123456`ã€‚

### åœºæ™¯ 1ï¼šDocker é•œåƒåŠ é€Ÿ (æ— éœ€å¯†ç )

Worker ä¼šè‡ªåŠ¨æ£€æµ‹ Docker å®¢æˆ·ç«¯ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

ç›´æ¥æ‹‰å–å®˜æ–¹é•œåƒ (è‡ªåŠ¨è¡¥å…¨ library):
```bash
docker pull [docker.example.com/nginx](https://docker.example.com/nginx)
docker pull [docker.example.com/mysql:8.0](https://docker.example.com/mysql:8.0)
docker pull [docker.example.com/alpine](https://docker.example.com/alpine)

æ‹‰å–ç¬¬ä¸‰æ–¹é•œåƒ (ghcr.io, quay.io ç­‰):
# GitHub Container Registry
docker pull [docker.example.com/ghcr.io/username/image:tag](https://docker.example.com/ghcr.io/username/image:tag)

# Google Container Registry
docker pull [docker.example.com/gcr.io/google-samples/hello-app:1.0](https://docker.example.com/gcr.io/google-samples/hello-app:1.0)
